<html>
<head>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
    <script src="../../static/lib/functional.js"></script>
    <script src="../../static/lib/to-function.js"></script>
    <style>
        .removed {
            text-decoration: line-through
        }
        .fail {
            color: red;
        }
        .pass {
            color: green;
        }
    </style>
    <script>
    Functional.install()
    String.prototype.supplant = function (o) {
        return this.replace(/\$(\w*)/g, function (a, b) {
                var v = o[b];
                if (v) return v
                else throw "no value for " + b;
        });
    };
    function removeResult(linkNode, rev, duration) {
        $.post('remove', {revision: rev, duration: duration}, function() {
            $(linkNode).parent().addClass('removed');
            $(linkNode).replaceWith("");
        });
    }
    $(document).ready(function() {
        $.getJSON('json', function(data) {
            var bestResult = data[0];
            var results = data[1];
            var lis = map(
                function(result) {
                    var passed = result[2];
                    return '<li class="$klass">revision: $rev, duration: $duration \
                        <a href="#" style="text-decoration: none" onclick="removeResult(this, \'$rev\', $duration)">(-)</a></li>'
                        .supplant({rev: result[0], duration: result[1], klass: passed && 'pass' || 'fail'});
                },
                results
            );
            $('#results').append(lis.join(''));
        });
    });
    </script>
</head>
<body>
    Test Results, newest first

    <ul id='results'>
    </ul>
</body>
</html>
